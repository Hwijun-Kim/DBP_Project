<!DOCTYPE html>
<html lang="en" id="pj_html">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prompt Solution</title>
    <link rel="stylesheet" href="public/css/project_eval.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/f6319e9033.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body id="pj_body">
    <header id="header_pj">
        <script>

        </script>
        <nav class="navbar">
            <div class="navbar_logo">
                <img src="public/images/prompt.png" width="150px">
            </div>
            <ul class="navbar_menu">
                <li><a href="/main">Project</a></li>
                <li><a href="/employee">Employee</a></li>
                <li><a href="/roadmap">Location</a></li>


            </ul>
            <ul class="navbar_icons">
                <li><i class="fa-solid fa-right-from-bracket" id="logout" style="font-size: 25px;"></i></li>
                <li><i class="fa-solid fa-user" id="mypage" style="font-size: 25px;"></i></li>
                <script>
                    const logoutIcon = document.getElementById('logout');
                    const mypageIcon = document.getElementById('mypage');
                    //로그아웃 (로그인 페이지로 이동)
                    logoutIcon.addEventListener('click',function(){
                        window.location.href='/'
                        // 로그아웃 메세지 전송
                        alert('로그아웃 되었습니다.');
                    })

                    //마이페이지 이동
                    mypageIcon.addEventListener('click',function(){
                        window.location.href='/mypage'
                    })
                </script>
            </ul>
        </nav>
    </header>
    <section class="contents-wrap">
        <div class="con_title-group" style="margin: 20px;">
            <!-- <div class="con-title" >
                평가 조회 
            </div> -->
            <div class="con-title" id="p_title" >
                프로젝트 이름
            </div>
            <br>
            <div class="con-title" id="e_title">
                사원 이름
            </div>

            <script>
                window.onload = function() {
                    var p_name = localStorage.getItem('p_name');
                    var e_name = localStorage.getItem('e_name');
                    var position = localStorage.getItem('position');

                    var divElement = document.getElementById("p_title");
                    divElement.textContent = "프로젝트 이름 : "+p_name;
                    

                    var divElement2 = document.getElementById("e_title");
                    divElement2.innerHTML = "직원 이름 : "+e_name+" ("+position+")";
                }
            </script>
        </div>
        <div class="eval_table" id="pmEvaluation">
            <div style="margin: 20px; font-size: 20px; font-weight: bold;">
                PM평가
            </div>
            
            <div class="basic-group">
                <div class="card-item basic">
                    <div id="result">
                        <div class="read-table">
                            <div class="horizontal-scroller">
                                <table class="index_table" id = "pmTable" border="1" style="background-color: #EAECF2;">
                                    <colgroup>
                                    <!-- 이후에 지정 -->
                                    </colgroup>
                                    <thead>
                                        <tr>
                                            <td colspan="2">업무 수행 능력</td>
                                            <td colspan="2">커뮤니케이션 능력</td>
                                        </tr>
                                        <tr>
                                            <td >점수</td>
                                            <td>내용</td>
                                            <td >점수</td>
                                            <td>내용</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- 내용 -->
                                    </tbody>
                                </table>
                                <div style="display: inline-block; align-content: center; padding-right: 100px; width: 42%;">
                                    <p style="text-align: center;" >
                                        <label style="text-align: center; font-size: 20px; font-weight: bold;">
                                            평균점수 :
                                        </label>
                                        <label style="text-align: center; font-size: 20px; font-weight: bold; color: blue;"id="avg1">
                                            
                                        </label>
                                    </p>
                                </div>
                                <div style="display: inline-block; align-content: center; padding-right: 100px; width: 42%;">
                                    <p style="text-align: center;" >
                                        <label style="text-align: center; font-size: 20px; font-weight: bold;">
                                            평균점수 :
                                        </label>
                                        <label style="text-align: center; font-size: 20px; font-weight: bold; color: blue;"id="avg2">
                                            
                                        </label>
                                    </p>
                                </div>

                                
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="eval_table">
            <div style="margin: 20px; font-size: 20px; font-weight: bold;">
                고객 평가
            </div>
            
            <div class="basic-group">
                <div class="card-item basic">
                    <div id="result">
                        <div class="read-table">
                            <div class="horizontal-scroller">
                                <table class="index_table" id = "customerTable" border="1" style="background-color: #EAECF2;">
                                    <colgroup>
                                    <!-- 이후에 지정 -->
                                    </colgroup>
                                    <thead>
                                        <tr>
                                            <td colspan="2">업무 수행 능력</td>
                                            <td colspan="2">커뮤니케이션 능력</td>
                                        </tr>
                                        <tr>
                                            <td >점수</td>
                                            <td>내용</td>
                                            <td >점수</td>
                                            <td>내용</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- 내용 -->
                                    </tbody>
                                </table>
                                <div style="display: inline-block; align-content: center; padding-right: 100px; width: 42%;">
                                    <p style="text-align: center;" >
                                        <label style="text-align: center; font-size: 20px; font-weight: bold;">
                                            평균점수 :
                                        </label>
                                        <label style="text-align: center; font-size: 20px; font-weight: bold; color: blue;" id="avg3">
                                            
                                        </label>
                                    </p>
                                </div>
                                <div style="display: inline-block; align-content: center; padding-right: 100px; width: 42%;">
                                    <p style="text-align: center;" >
                                        <label style="text-align: center; font-size: 20px; font-weight: bold;">
                                            평균점수 :
                                        </label>
                                        <label style="text-align: center; font-size: 20px; font-weight: bold; color: blue;" id="avg4">
                                            
                                        </label>
                                    </p>
                                </div>

                                
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="eval_table" id="peerEvaluation">
            <div style="margin: 20px; font-size: 20px; font-weight: bold;">
                동료 평가
            </div>
            
            <div class="basic-group">
                <div class="card-item basic">
                    <div id="result">
                        <div class="read-table">
                            <div class="horizontal-scroller">
                                <table class="index_table" id = "peerTable" border="1" style="background-color: #EAECF2;">
                                    <colgroup>
                                    <!-- 이후에 지정 -->
                                    </colgroup>
                                    <thead>
                                        <tr>
                                            <td colspan="2">업무 수행 능력</td>
                                            <td colspan="2">커뮤니케이션 능력</td>
                                        </tr>
                                        <tr>
                                            <td >점수</td>
                                            <td>내용</td>
                                            <td >점수</td>
                                            <td>내용</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- 내용 -->
                                    </tbody>
                                </table>
                                <div style="display: inline-block; align-content: center; padding-right: 100px; width: 42%;">
                                    <p style="text-align: center;" >
                                        <label style="text-align: center; font-size: 20px; font-weight: bold;">
                                            평균점수 :
                                        </label>
                                        <label style="text-align: center; font-size: 20px; font-weight: bold; color: blue;"id="avg5">
                                            
                                        </label>
                                    </p>
                                </div>
                                <div style="display: inline-block; align-content: center; padding-right: 100px; width: 42%;">
                                    <p style="text-align: center;" >
                                        <label style="text-align: center; font-size: 20px; font-weight: bold;">
                                            평균점수 :
                                        </label>
                                        <label style="text-align: center; font-size: 20px; font-weight: bold; color: blue;"id="avg6">
                                            
                                        </label>
                                    </p>
                                </div>
                                
                                <script>
                                    var e_id = localStorage.getItem('e_id');
                                    var p_id = localStorage.getItem('p_id');
                                    var position = localStorage.getItem('position');
                                    
                                    //position이 PM이면 다른 평가를 받을 일이 없으므로 고객평가만 띄우기
                                    var pmEvaluationTable = document.getElementById('pmEvaluation');
                                    var peerEvaluationTable = document.getElementById('peerEvaluation');

                                    if (position === 'PM') {
                                    pmEvaluationTable.style.display = 'none';
                                    peerEvaluationTable.style.display = 'none';}
                                    
                                    //test
                                    //p_id="P0001"
                                    //e_id="E0002"
                                    console.log(e_id,p_id,position)

                                    axios
                                        .get('/api/project/evaluation/'+e_id+'/'+p_id)
                                        .then(function (response) {
                                            var data = response.data.result;
                                            console.log(data)

                                            //Table1(PM평가)
                                            var tableBody = document.querySelector('#pmTable tbody');
                                            // 기존 내용 초기화
                                            tableBody.innerHTML = '';

                                            //datas.forEach(function(data) {

                                            var row = document.createElement('tr');

                                            //업무 수행 점수
                                            var work_score_Cell = document.createElement('td');
                                            work_score_Cell.textContent = data.pm.working_score;
                                            row.appendChild(work_score_Cell);
                                            //내용
                                            var work_score_content_Cell = document.createElement('td');
                                            work_score_content_Cell.textContent = data.pm.working_comment;
                                            row.appendChild(work_score_content_Cell);
                                            //커뮤니케이션 점수
                                            var cummuni_score_Cell = document.createElement('td');
                                            cummuni_score_Cell.textContent = data.pm.communication_score;
                                            row.appendChild(cummuni_score_Cell);
                                            //내용
                                            var cummuni_content_Cell = document.createElement('td');
                                            cummuni_content_Cell.textContent = data.pm.communication_comment;
                                            row.appendChild(cummuni_content_Cell);

                                            tableBody.appendChild(row);

                                            row.style.background = 'white';

                                            

                                            //Table2(고객평가)
                                            var tableBody = document.querySelector('#customerTable tbody');
                                            // 기존 내용 초기화
                                            tableBody.innerHTML = '';

                                            var row = document.createElement('tr');

                                            //업무 수행 점수
                                            var work_score2_Cell = document.createElement('td');
                                            work_score2_Cell.textContent = data.customer.working_score;
                                            row.appendChild(work_score2_Cell);
                                            //내용
                                            var work_score_content2_Cell = document.createElement('td');
                                            work_score_content2_Cell.textContent = data.customer.working_comment;
                                            row.appendChild(work_score_content2_Cell);
                                            //커뮤니케이션 점수
                                            var cummuni_score2_Cell = document.createElement('td');
                                            cummuni_score2_Cell.textContent = data.customer.communication_score;
                                            row.appendChild(cummuni_score2_Cell);
                                            //내용
                                            var cummuni_content2_Cell = document.createElement('td');
                                            cummuni_content2_Cell.textContent = data.customer.communication_comment;
                                            row.appendChild(cummuni_content2_Cell);

                                            tableBody.appendChild(row);
                                            row.style.background = 'white';

                                            //Table3(동료평가)
                                            var tableBody = document.querySelector('#peerTable tbody');
                                            // 기존 내용 초기화
                                            tableBody.innerHTML = '';

                                            data.peer.evaluation.forEach(function(data) {
                                            
                                                var row = document.createElement('tr');
                                                //업무 수행 점수
                                                var work_score3_Cell = document.createElement('td');
                                                work_score3_Cell.textContent = data.working_score;
                                                row.appendChild(work_score3_Cell);
                                                //업무 수행 내용
                                                var work_score_content3_Cell = document.createElement('td');
                                                work_score_content3_Cell.textContent = data.working_comment;
                                                row.appendChild(work_score_content3_Cell);
                                                //커뮤니케이션 점수
                                                var cummuni_score3_Cell = document.createElement('td');
                                                cummuni_score3_Cell.textContent = data.communication_score;
                                                row.appendChild(cummuni_score3_Cell);
                                                //커뮤니케이션 내용
                                                var cummuni_content3_Cell = document.createElement('td');
                                                cummuni_content3_Cell.textContent = data.communication_comment;
                                                row.appendChild(cummuni_content3_Cell);

                                    
                                            tableBody.appendChild(row);
                                            row.style.background = 'white';
                                            })

                                            //평균 점수(6개) 출력하기 
                                            //pm
                                            var score1 = document.getElementById('avg1');
                                            if (typeof data.pm.working_score === 'undefined') {
                                                score1.textContent = "미기입";
                                            } else {
                                                score1.textContent = data.pm.working_score + "점";
                                            }

                                            var score2 = document.getElementById('avg2');
                                            if (typeof data.pm.communication_score === 'undefined') {
                                                score2.textContent = "미기입";
                                            } else {
                                                score2.textContent = data.pm.communication_score+"점";
                                            }

                                            //customer
                                            var score3 = document.getElementById('avg3');
                                            if (typeof data.customer.working_score === 'undefined') {
                                                score3.textContent = "미기입";
                                            } else {
                                                score3.textContent = data.customer.working_score + "점";
                                            }

                                            var score4 = document.getElementById('avg4');
                                            if (typeof data.customer.communication_score === 'undefined') {
                                                score4.textContent = "미기입";
                                            } else {
                                                score4.textContent = data.customer.communication_score+"점";
                                            }

                                            //peer
                                            var score5 = document.getElementById('avg5');
                                            if ( data.peer.avg_score.work_avg === null) {
                                                score5.textContent = "미기입";
                                            } else {
                                                score5.textContent = data.peer.avg_score.work_avg + "점";
                                            }

                                            var score6 = document.getElementById('avg6');
                                            if ( data.peer.avg_score.com_avg === null) {
                                                score6.textContent = "미기입";
                                            } else {
                                                score6.textContent = data.peer.avg_score.com_avg+"점";
                                            }
                                            
                                        })
                                        .catch(function (error) {
                                            if (error.response) {
                                                alert(error.response.data.message);
                                            } else {
                                                console.log(error);
                                                alert('직원 평가 조회에 실패하였습니다');
                                            }
                                        });
                                    
                                </script>
                                
                            </div>
                        </div>




                    </div>
                </div>
            </div>
        </div>
        
        
        
        

    </section>
</body>
</html>